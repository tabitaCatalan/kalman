<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Updaters · KalmanFilter.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">KalmanFilter.jl</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">KalmanFilter.jl</a></li><li><a class="tocitem" href="iterators.html">Iterators</a></li><li class="is-active"><a class="tocitem" href="updaters.html">Updaters</a><ul class="internal"><li><a class="tocitem" href="#LinearizableUpdater"><span><code>LinearizableUpdater</code></span></a></li><li><a class="tocitem" href="#Otros-KalmanUpdaters-implementados"><span>Otros <code>KalmanUpdaters</code> implementados</span></a></li><li><a class="tocitem" href="#Consideraciones-adicionales"><span>Consideraciones adicionales</span></a></li></ul></li><li><a class="tocitem" href="observers.html">Observers</a></li><li><a class="tocitem" href="systems.html">Systems</a></li><li><a class="tocitem" href="discretizers.html">Discretizers</a></li><li><span class="tocitem">Ejemplos</span><ul><li><a class="tocitem" href="ejemplos/NLFilterUnknownInput.html">Filtro de Kalman Extendido con input desconocido</a></li><li><a class="tocitem" href="ejemplos/NLFilter.html">Filtro de Kalman Extendido</a></li><li><a class="tocitem" href="ejemplos/NLFilterENKF.html">Filtro de Kalman por ensambles</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="updaters.html">Updaters</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="updaters.html">Updaters</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/tabitaCatalan/kalman/blob/master/docs/src/updaters.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Actualizar-el-sistema:-KalmanUpdater"><a class="docs-heading-anchor" href="#Actualizar-el-sistema:-KalmanUpdater">Actualizar el sistema: KalmanUpdater</a><a id="Actualizar-el-sistema:-KalmanUpdater-1"></a><a class="docs-heading-anchor-permalink" href="#Actualizar-el-sistema:-KalmanUpdater" title="Permalink"></a></h1><p>El tipo abstracto <code>KalmanUpdater</code> está pensado como una interfaz a las estructuras que permitan actualizar el sistema desde un estado <span>$x_{n}$</span> a un estado <span>$x_{n+1}$</span>.</p><p>Para que funciones correctamente deben implementarse los siguientes métodos:</p><table><tr><th style="text-align: right">Métodos a implementar</th><th style="text-align: right">Breve descripción</th></tr><tr><td style="text-align: right"><code>update!(L::KalmanUpdater, hatx, hatP, control, t)</code></td><td style="text-align: right">un método que permita actualizar al iterador y dejarlo listo para la siguiente iteración. Cuando se usan matrices <span>$M_n := M, B_n := B, F_n:= F$</span> contantes se puede dejar en blanco, pero debería usarse, por ejemplo, para linearlizar en torno a <span>$\hat{x}_n$</span> cuando se usa un <code>KalmanUpdater</code> no lineal.</td></tr><tr><td style="text-align: right"><code>forecast(updater::KalmanUpdater, hatx, hatP, control, t)</code></td><td style="text-align: right">Devuelve una tupla que contiene a <span>$\hat{x}_{n+1, n}, \hat{P}_{n+1, n}$</span> a partir de <span>$\hat{x}_{n,n}$</span>(<code>hatx</code>), <span>$\hat{P}_{n,n}$</span>(<code>hatP</code>) y un control.</td></tr><tr><td style="text-align: right"><code>dt(updater::KalmanUpdater)</code></td><td style="text-align: right"><span>$\Delta t$</span></td></tr></table><h2 id="LinearizableUpdater"><a class="docs-heading-anchor" href="#LinearizableUpdater"><code>LinearizableUpdater</code></a><a id="LinearizableUpdater-1"></a><a class="docs-heading-anchor-permalink" href="#LinearizableUpdater" title="Permalink"></a></h2><p>Un grupo importante de <code>KalmanUpdater</code>s serán los que, o bien son lineales de la forma</p><p class="math-container">\[x_{n+1} = M_n x_n + B_n u_n + F_n N_n\]</p><p>(donde <span>$M_n, F_n$</span> son matrices, <span>$x_n, N_n, B_n$</span> vectores y <span>$u_n$</span> es un control escalar), o bien, en caso de ser no lineales <span>$x_{n+1} = \mathcal{M}(x_n, u_n)$</span>, pueden ser linealizados a la forma anterior.</p><p>Los miembros de esta clase necesitan implementar: </p><table><tr><th style="text-align: right">Métodos a implementar</th><th style="text-align: right">Breve descripción</th></tr><tr><td style="text-align: right"><code>Mn</code>, <code>Bn</code>, <code>Fn</code></td><td style="text-align: right">De la linearización en el estado actual</td></tr></table><p>Los miembros de esta clase tienen automáticamente definidos los métodos:</p><pre><code class="language-julia">forecast(updater::LinearizableUpdater, hatx, hatP, control, t)
forecast_with_error(updater::LinearizableUpdater, hatx, hatP, control, t)
forecast_hatP(updater::LinearizableUpdater, hatP)</code></pre><div class="admonition is-info"><header class="admonition-header">Forecast con error</header><div class="admonition-body"><p>Para usar <code>EnKF</code>&lt;!–TODO: agregar referencia a EnKF–&gt; es necesario que el <code>KalmanUpdater</code> usado tenga implementado <code>forecast_with_error</code>. Esto permite hacer un paso de <em>forecast</em> e incluir error.</p></div></div><p>Cuentan además con las siguientes funciones</p><article class="docstring"><header><a class="docstring-binding" id="KalmanFilter.dimensions" href="#KalmanFilter.dimensions"><code>KalmanFilter.dimensions</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">dimensions(updater::KalmanFilter.LinearizableUpdater) -&gt; Any
</code></pre><p>Devuelve el número de dimensiones que puede soportar el <code>LinearizableUpdater</code> en el estado. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tabitaCatalan/kalman/blob/f449e5e0fa5c4f5c9450f8d738e73d18e0ba4f5e/src/updaters.jl#L53">source</a></section><section><div><pre><code class="language-julia">dimensions(observer::KalmanFilter.KalmanObserver) -&gt; Any
</code></pre><p>Devuelve el número de dimensiones que puede soportar el <code>LinearizableUpdater</code> en el estado. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tabitaCatalan/kalman/blob/f449e5e0fa5c4f5c9450f8d738e73d18e0ba4f5e/src/observers.jl#L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="KalmanFilter.noiser" href="#KalmanFilter.noiser"><code>KalmanFilter.noiser</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">noiser(updater::KalmanFilter.LinearizableUpdater) -&gt; Any
</code></pre><p>Devuelve una distribución normal multivariada <span>$\mathcal{N}(0, Q)$</span>,  donde <span>$Q$</span> es la matriz de covarianzas del <code>LinearizableUpdater</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tabitaCatalan/kalman/blob/f449e5e0fa5c4f5c9450f8d738e73d18e0ba4f5e/src/updaters.jl#L61">source</a></section></article><p>los <code>KalmanUpdater</code>s de este tipo implementados son:</p><h3 id="SimpleLinearUpdater"><a class="docs-heading-anchor" href="#SimpleLinearUpdater">SimpleLinearUpdater</a><a id="SimpleLinearUpdater-1"></a><a class="docs-heading-anchor-permalink" href="#SimpleLinearUpdater" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="KalmanFilter.SimpleLinearUpdater" href="#KalmanFilter.SimpleLinearUpdater"><code>KalmanFilter.SimpleLinearUpdater</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct SimpleLinearUpdater{T} &lt;: KalmanFilter.LinearizableUpdater</code></pre><p>Define un actualizador lineal constante.</p><p>Define un actualizador lineal del sistema, que permite calcular el estado <span>$x_{n+1}$</span> a partir del estado <span>$x_{n}$</span> y un control escalar <span>$u_n$</span> según</p><p class="math-container">\[x_{n+1} = M x_n + B u_n + F N_n\]</p><p>donde <span>$N_n$</span> es un número aleatorio (dado por una variable aleatorio normal <span>$\mathcal{N}(0,1)$</span>).</p><p><strong>Campos</strong></p><ul><li><p><code>M::AbstractArray{T,2} where T</code></p><p>Matriz <span>$M$</span></p></li><li><p><code>B::AbstractArray{T,1} where T</code></p><p>Vector <span>$B$</span></p></li><li><p><code>F::AbstractArray{T,2} where T</code></p><p>Matriz <span>$F$</span></p></li><li><p><code>Q::AbstractArray{T,2} where T</code></p><p>Matriz <span>$Q$</span> de covarianzas del error</p></li><li><p><code>dt::Any</code></p><p><span>$\Delta t$</span></p></li><li><p><code>integrity::Any</code></p><p>Función que corrige <code>x</code> para dejarlo dentro de un dominio.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tabitaCatalan/kalman/blob/f449e5e0fa5c4f5c9450f8d738e73d18e0ba4f5e/src/updaters.jl#L73">source</a></section></article><h3 id="NLUpdater"><a class="docs-heading-anchor" href="#NLUpdater">NLUpdater</a><a id="NLUpdater-1"></a><a class="docs-heading-anchor-permalink" href="#NLUpdater" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="KalmanFilter.NLUpdater" href="#KalmanFilter.NLUpdater"><code>KalmanFilter.NLUpdater</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">mutable struct NLUpdater &lt;: KalmanFilter.LinearizableUpdater</code></pre><p>Define un actualizador dado por la discretización de una ODE.</p><p>Define un actualizador posiblemente no lineal del sistema, a partir de la discretización de una Ecuación Diferencial Ordinaria. Esto permite calcular el estado <span>$x_{n+1}$</span> a partir del estado <span>$x_{n}$</span> y el control <span>$u_n$</span> según</p><p class="math-container">\[x_{n+1} = \mathcal{M}(x_n, u_n) + F N_n\]</p><p>donde <span>$N_n$</span> es un número aleatorio (dado por una variable aleatorio normal <span>$\mathcal{N}(0,Q)$</span>) y <span>$\mathcal{M}$</span> está dada por un <code>Discretizer</code>.</p><p>En todo tiempo guarda una versión linealizada del sistema, en torno a un punto  <span>$x_n, u_n, t_n$</span> (al construirlo se le deben dar esos valores también.)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tabitaCatalan/kalman/blob/f449e5e0fa5c4f5c9450f8d738e73d18e0ba4f5e/src/NLkalman.jl#L8">source</a></section></article><p>Ambas estructuras pueden ser además evaluadas en la firma <code>(::KalmanUpdater)(x::AbstractArray, u::Real, error)</code>. Por ejemplo, para el caso no lineal, <code>nlupdater(x,u,ε)</code> devuelve <span>$\mathcal{M}(x,u) + Fε$</span>.</p><h2 id="Otros-KalmanUpdaters-implementados"><a class="docs-heading-anchor" href="#Otros-KalmanUpdaters-implementados">Otros <code>KalmanUpdaters</code> implementados</a><a id="Otros-KalmanUpdaters-implementados-1"></a><a class="docs-heading-anchor-permalink" href="#Otros-KalmanUpdaters-implementados" title="Permalink"></a></h2><p>Un actualizador importante es <code>ODEForecaster</code>, que ofrece un enfoque alternativo para trabajar con ecuaciones diferenciales estocásticas de la forma </p><p class="math-container">\[x(t) = F(x, t)dt + G(x, t)dW(t)\]</p><p>Este método se llama Filtro de Kalman Continuo Discreto, y es muy similar al Filtro de Kalman Extendido, pero el paso de <em>forecast</em> se hace resolviendo una ecuación diferencial acoplada, la Ecuación de los Momentos, para <span>$\hat{x}$</span> y <span>$\hat{P}$</span>:</p><p class="math-container">\[\begin{aligned}
\hat{x}&#39;(t) &amp;= F(\hat{x},t) \\ 
\hat{P}&#39;(t) &amp;= \partial_\hat{x} F(\hat{x}, t) \hat{P} + \hat{P} \left( \partial_\hat{x} F(\hat{x}, t) \right) ^{\top} + G(t)Q(t)G(t)&#39;
\end{aligned}\]</p><p>De esta forma, para obtener <span>$\hat{x}_{n+1,n}, \hat{P}_{n+1,n}$</span> basta con resolver la ecuación de los momentos en <span>$[t_{n}, t_{n+1}]$</span>, con condiciones iniciales <span>$\hat{x}_{n+1,n}, \hat{P}_{n+1,n}$</span>.</p><h3 id="ODEForecaster"><a class="docs-heading-anchor" href="#ODEForecaster">ODEForecaster</a><a id="ODEForecaster-1"></a><a class="docs-heading-anchor-permalink" href="#ODEForecaster" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="KalmanFilter.ODEForecaster" href="#KalmanFilter.ODEForecaster"><code>KalmanFilter.ODEForecaster</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Outer constructor</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tabitaCatalan/kalman/blob/f449e5e0fa5c4f5c9450f8d738e73d18e0ba4f5e/src/ODEUpdater.jl#L15-L17">source</a></section></article><h2 id="Consideraciones-adicionales"><a class="docs-heading-anchor" href="#Consideraciones-adicionales">Consideraciones adicionales</a><a id="Consideraciones-adicionales-1"></a><a class="docs-heading-anchor-permalink" href="#Consideraciones-adicionales" title="Permalink"></a></h2><h3 id="Función-de-integridad"><a class="docs-heading-anchor" href="#Función-de-integridad">Función de integridad</a><a id="Función-de-integridad-1"></a><a class="docs-heading-anchor-permalink" href="#Función-de-integridad" title="Permalink"></a></h3><p>En general los constructores pedirán además una <strong>función de integridad</strong>; cuya idea es evitar que los estados se salgan de cierto dominio. Por ejemplo, para el caso en que trabajamos con EDOs epidemiológicas, es necesario que las cantidades sean no negativas, por lo que se usa la función de integridad <code>(x) -&gt; max.(x, 0.)</code>, que transforma un vector <code>x</code> para dejar en 0 las coordenadas negativas.</p><h3 id="update_inner_system-y-update_aproximation"><a class="docs-heading-anchor" href="#update_inner_system-y-update_aproximation"><code>update_inner_system</code> y <code>update_aproximation</code></a><a id="update_inner_system-y-update_aproximation-1"></a><a class="docs-heading-anchor-permalink" href="#update_inner_system-y-update_aproximation" title="Permalink"></a></h3><p>Aún no está definida del todo la interfaz de <code>KalmanUpdater</code>, y varias estructuras implementan estos dos métodos.  </p><p>CREO que ya ni siquiera es necesaria la distinción, pues venía del hecho de que <code>KalmanIterator</code> manejaba los ruidos, cosa que ahora hace <code>KalmanUpdater</code>. En todo caso, ciertos actualizadores como <code>ODEForecaster</code> no tienen definido un método <code>update_inner_system</code> porque no están pensados para hacer eso (solo deberían usarse con <code>Measurements</code>, no con <code>InnerState</code>s). Es necesario implementar <em>holy traits</em> o algo así para diferenciar mejor los métodos que deben implementarse.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="iterators.html">« Iterators</a><a class="docs-footer-nextpage" href="observers.html">Observers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 13 August 2021 22:10">Friday 13 August 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
